<div class="preview-container">
  <div class="preview-header mb-4">
    <h2 class="preview-title">Vista previa</h2>
    <p class="preview-subtitle">
      Completa tus datos y verás la información acá.
    </p>
  </div>

  <div class="preview-content" *ngIf="hasData(); else emptyState">
    <ng-container *ngIf="previewReady">
      <!-- Páginas A4 apiladas (como Word). El scroll es del panel, no de la hoja. -->
      <div class="cv-pages">
        <div class="a4-page" *ngFor="let p of pages; let pageIndex = index">
          <div class="a4-inner">
            <div class="cv-layout" [ngClass]="'cv-layout-' + selectedTemplateId">
            <!-- Header SOLO en la primera página -->
            <ng-container *ngIf="pageIndex === 0">
              <div class="cv-first-page-header" #firstPageHeader>
                <ng-container [ngSwitch]="selectedTemplateId">
                  <!-- ========================= -->
                  <!-- PLANTILLA 2 (template-2)  -->
                  <!-- ========================= -->
                  <ng-container *ngSwitchCase="'template-2'">
                    <div class="cv-header cv-header--t2 text-center">
                      <div class="cv-photo-wrapper-t2" *ngIf="cvData.personalInfo.foto">
                        <div class="cv-photo-circle">
                          <img [src]="cvData.personalInfo.foto" alt="Foto de perfil" class="cv-photo-img">
                        </div>
                      </div>

                      <h1 class="cv-name">
                        {{ cvData.personalInfo.nombres }} {{ cvData.personalInfo.apellidos }}
                      </h1>
                      <p class="cv-position" *ngIf="cvData.personalInfo.puesto">
                        {{ cvData.personalInfo.puesto }}
                      </p>

                      <div
                        class="cv-contact-line"
                        *ngIf="
                          cvData.personalInfo.email ||
                          cvData.personalInfo.celular ||
                          cvData.personalInfo.ubicacion ||
                          cvData.personalInfo.nacionalidad ||
                          cvData.personalInfo.fechaNacimiento ||
                          getAgeFromBirthDate(cvData.personalInfo.fechaNacimiento) !== null
                        ">
                        <span class="cv-contact-inline" *ngIf="cvData.personalInfo.email">
                          <span class="cv-contact-label-inline">{{ cvData.labels.labelEmail }}</span>
                          <span class="cv-contact-value-inline">{{ cvData.personalInfo.email }}</span>
                        </span>
                        <span class="cv-contact-inline" *ngIf="cvData.personalInfo.celular">
                          <span class="cv-contact-label-inline">{{ cvData.labels.labelPhone }}</span>
                          <span class="cv-contact-value-inline">{{ cvData.personalInfo.celular }}</span>
                        </span>
                        <span class="cv-contact-inline" *ngIf="cvData.personalInfo.ubicacion">
                          <span class="cv-contact-label-inline">{{ cvData.labels.labelAddress }}</span>
                          <span class="cv-contact-value-inline">{{ cvData.personalInfo.ubicacion }}</span>
                        </span>
                        <span class="cv-contact-inline" *ngIf="cvData.personalInfo.nacionalidad">
                          <span class="cv-contact-label-inline">{{ cvData.labels.labelNationality }}</span>
                          <span class="cv-contact-value-inline">{{ cvData.personalInfo.nacionalidad }}</span>
                        </span>
                        <span class="cv-contact-inline" *ngIf="cvData.personalInfo.fechaNacimiento">
                          <span class="cv-contact-label-inline">{{ cvData.labels.labelBirthDate }}</span>
                          <span class="cv-contact-value-inline">{{ cvData.personalInfo.fechaNacimiento }}</span>
                        </span>
                        <span class="cv-contact-inline" *ngIf="getAgeFromBirthDate(cvData.personalInfo.fechaNacimiento) !== null">
                          <span class="cv-contact-label-inline">{{ cvData.labels.labelAge }}</span>
                          <span class="cv-contact-value-inline">{{ getAgeFromBirthDate(cvData.personalInfo.fechaNacimiento) }} años</span>
                        </span>
                      </div>
                    </div>
                  </ng-container>

                  <!-- ========================= -->
                  <!-- PLANTILLA 3 (template-3)  -->
                  <!-- ========================= -->
                  <ng-container *ngSwitchCase="'template-3'">
                    <div class="cv-header cv-header--t3">
                      <div class="cv-header-t3-top">
                        <div class="cv-header-t3-left">
                          <div class="cv-photo-circle cv-photo-circle--t3" *ngIf="cvData.personalInfo.foto">
                            <img [src]="cvData.personalInfo.foto" alt="Foto de perfil" class="cv-photo-img">
                          </div>
                          <div class="cv-header-t3-name">
                            <h1 class="cv-name mb-0">
                              {{ cvData.personalInfo.nombres }} {{ cvData.personalInfo.apellidos }}
                            </h1>
                            <p class="cv-position mb-0" *ngIf="cvData.personalInfo.puesto">
                              {{ cvData.personalInfo.puesto }}
                            </p>
                          </div>
                        </div>
                      </div>

                      <div
                        class="cv-header-t3-contact"
                        *ngIf="
                          cvData.personalInfo.email ||
                          cvData.personalInfo.celular ||
                          cvData.personalInfo.ubicacion ||
                          cvData.personalInfo.nacionalidad ||
                          cvData.personalInfo.fechaNacimiento ||
                          getAgeFromBirthDate(cvData.personalInfo.fechaNacimiento) !== null
                        ">
                        <div class="cv-t3-contact-item" *ngIf="cvData.personalInfo.email">
                          <div class="cv-t3-contact-label">{{ cvData.labels.labelEmail }}</div>
                          <div class="cv-t3-contact-value">{{ cvData.personalInfo.email }}</div>
                        </div>
                        <div class="cv-t3-contact-item" *ngIf="cvData.personalInfo.celular">
                          <div class="cv-t3-contact-label">{{ cvData.labels.labelPhone }}</div>
                          <div class="cv-t3-contact-value">{{ cvData.personalInfo.celular }}</div>
                        </div>
                        <div class="cv-t3-contact-item" *ngIf="cvData.personalInfo.ubicacion">
                          <div class="cv-t3-contact-label">{{ cvData.labels.labelAddress }}</div>
                          <div class="cv-t3-contact-value">{{ cvData.personalInfo.ubicacion }}</div>
                        </div>
                        <div class="cv-t3-contact-item" *ngIf="cvData.personalInfo.nacionalidad">
                          <div class="cv-t3-contact-label">{{ cvData.labels.labelNationality }}</div>
                          <div class="cv-t3-contact-value">{{ cvData.personalInfo.nacionalidad }}</div>
                        </div>
                        <div class="cv-t3-contact-item" *ngIf="cvData.personalInfo.fechaNacimiento">
                          <div class="cv-t3-contact-label">{{ cvData.labels.labelBirthDate }}</div>
                          <div class="cv-t3-contact-value">{{ cvData.personalInfo.fechaNacimiento }}</div>
                        </div>
                        <div class="cv-t3-contact-item" *ngIf="getAgeFromBirthDate(cvData.personalInfo.fechaNacimiento) !== null">
                          <div class="cv-t3-contact-label">{{ cvData.labels.labelAge }}</div>
                          <div class="cv-t3-contact-value">{{ getAgeFromBirthDate(cvData.personalInfo.fechaNacimiento) }} años</div>
                        </div>
                      </div>
                    </div>
                  </ng-container>

                  <!-- ========================= -->
                  <!-- PLANTILLA 4 (template-4)  -->
                  <!-- ========================= -->
                  <ng-container *ngSwitchCase="'template-4'">
                    <div class="cv-header cv-header--t4">
                      <div class="cv-header-t4-inner">
                        <div class="cv-header-t4-left">
                          <div class="cv-photo-circle cv-photo-circle--t4-header" *ngIf="cvData.personalInfo.foto">
                            <img [src]="cvData.personalInfo.foto" alt="Foto de perfil" class="cv-photo-img">
                          </div>
                          <h1 class="cv-name mb-0">
                            {{ cvData.personalInfo.nombres }} {{ cvData.personalInfo.apellidos }}
                          </h1>
                          <p class="cv-position mb-0" *ngIf="cvData.personalInfo.puesto">
                            {{ cvData.personalInfo.puesto }}
                          </p>
                        </div>

                        <div class="cv-header-t4-right" *ngIf="cvData.personalInfo.email || cvData.personalInfo.celular || cvData.personalInfo.ubicacion">
                          <div class="cv-t4-contact" *ngIf="cvData.personalInfo.email">
                            <span class="cv-t4-contact-label">{{ cvData.labels.labelEmail }}</span>
                            <span class="cv-t4-contact-value">{{ cvData.personalInfo.email }}</span>
                          </div>
                          <div class="cv-t4-contact" *ngIf="cvData.personalInfo.celular">
                            <span class="cv-t4-contact-label">{{ cvData.labels.labelPhone }}</span>
                            <span class="cv-t4-contact-value">{{ cvData.personalInfo.celular }}</span>
                          </div>
                          <div class="cv-t4-contact" *ngIf="cvData.personalInfo.ubicacion">
                            <span class="cv-t4-contact-label">{{ cvData.labels.labelAddress }}</span>
                            <span class="cv-t4-contact-value">{{ cvData.personalInfo.ubicacion }}</span>
                          </div>
                          <div class="cv-t4-contact" *ngIf="cvData.personalInfo.nacionalidad">
                            <span class="cv-t4-contact-label">{{ cvData.labels.labelNationality }}</span>
                            <span class="cv-t4-contact-value">{{ cvData.personalInfo.nacionalidad }}</span>
                          </div>
                          <div class="cv-t4-contact" *ngIf="cvData.personalInfo.fechaNacimiento">
                            <span class="cv-t4-contact-label">{{ cvData.labels.labelBirthDate }}</span>
                            <span class="cv-t4-contact-value">{{ cvData.personalInfo.fechaNacimiento }}</span>
                          </div>
                          <div class="cv-t4-contact" *ngIf="getAgeFromBirthDate(cvData.personalInfo.fechaNacimiento) !== null">
                            <span class="cv-t4-contact-label">{{ cvData.labels.labelAge }}</span>
                            <span class="cv-t4-contact-value">{{ getAgeFromBirthDate(cvData.personalInfo.fechaNacimiento) }} años</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </ng-container>

                  <!-- ========================= -->
                  <!-- PLANTILLA 5 (template-5)  -->
                  <!-- ========================= -->
                  <ng-container *ngSwitchCase="'template-5'">
                    <div class="cv-header cv-header--t5">
                      <div class="cv-header-t5-inner">
                        <div class="cv-header-t5-left">
                          <div class="cv-photo-circle cv-photo-circle--t5" *ngIf="cvData.personalInfo.foto">
                            <img [src]="cvData.personalInfo.foto" alt="Foto de perfil" class="cv-photo-img">
                          </div>
                          <div class="cv-header-t5-text">
                            <h1 class="cv-name mb-0">
                              {{ cvData.personalInfo.nombres }} {{ cvData.personalInfo.apellidos }}
                            </h1>
                            <p class="cv-position mb-0" *ngIf="cvData.personalInfo.puesto">
                              {{ cvData.personalInfo.puesto }}
                            </p>
                          </div>
                        </div>
                      </div>

                      <!-- Datos debajo (no a la derecha) -->
                      <div
                        class="cv-header-t5-bottom"
                        *ngIf="
                          cvData.personalInfo.email ||
                          cvData.personalInfo.celular ||
                          cvData.personalInfo.ubicacion ||
                          cvData.personalInfo.nacionalidad ||
                          cvData.personalInfo.fechaNacimiento ||
                          getAgeFromBirthDate(cvData.personalInfo.fechaNacimiento) !== null
                        ">
                        <div class="cv-t5-kv" *ngIf="cvData.personalInfo.email">
                          <span class="k">{{ cvData.labels.labelEmail }}</span>
                          <span class="v">{{ cvData.personalInfo.email }}</span>
                        </div>
                        <div class="cv-t5-kv" *ngIf="cvData.personalInfo.celular">
                          <span class="k">{{ cvData.labels.labelPhone }}</span>
                          <span class="v">{{ cvData.personalInfo.celular }}</span>
                        </div>
                        <div class="cv-t5-kv" *ngIf="cvData.personalInfo.ubicacion">
                          <span class="k">{{ cvData.labels.labelAddress }}</span>
                          <span class="v">{{ cvData.personalInfo.ubicacion }}</span>
                        </div>
                        <div class="cv-t5-kv" *ngIf="cvData.personalInfo.nacionalidad">
                          <span class="k">{{ cvData.labels.labelNationality }}</span>
                          <span class="v">{{ cvData.personalInfo.nacionalidad }}</span>
                        </div>
                        <div class="cv-t5-kv" *ngIf="cvData.personalInfo.fechaNacimiento">
                          <span class="k">{{ cvData.labels.labelBirthDate }}</span>
                          <span class="v">{{ cvData.personalInfo.fechaNacimiento }}</span>
                        </div>
                        <div class="cv-t5-kv" *ngIf="getAgeFromBirthDate(cvData.personalInfo.fechaNacimiento) !== null">
                          <span class="k">{{ cvData.labels.labelAge }}</span>
                          <span class="v">{{ getAgeFromBirthDate(cvData.personalInfo.fechaNacimiento) }} años</span>
                        </div>
                      </div>
                    </div>
                  </ng-container>

                  <!-- ========================= -->
                  <!-- PLANTILLA 6 (template-6)  -->
                  <!-- ========================= -->
                  <ng-container *ngSwitchCase="'template-6'">
                    <!-- Template 6: sin header (layout inicia directo en 2 columnas) -->
                  </ng-container>

                  <!-- ========================= -->
                  <!-- PLANTILLA 1 (template-1)  -->
                  <!-- ========================= -->
                  <ng-container *ngSwitchCase="'template-1'">

                    <div class="cv-header row align-items-center">
                      <div class="col-md-8">
                        <h1 class="cv-name">
                          {{ cvData.personalInfo.nombres }} {{ cvData.personalInfo.apellidos }}
                        </h1>
                        <p class="cv-position" *ngIf="cvData.personalInfo.puesto">
                          {{ cvData.personalInfo.puesto }}
                        </p>
                      </div>
                      <div class="col-md-4 text-md-end" *ngIf="cvData.personalInfo.foto">
                        <div class="cv-photo-wrapper d-inline-block">
                          <div class="cv-photo-circle">
                            <img [src]="cvData.personalInfo.foto" alt="Foto de perfil" class="cv-photo-img">
                          </div>
                        </div>
                      </div>
                    </div>


                    <div
                      class="cv-contact-bar mt-3"
                      *ngIf="
                        cvData.personalInfo.email ||
                        cvData.personalInfo.celular ||
                        cvData.personalInfo.ubicacion ||
                        cvData.personalInfo.nacionalidad ||
                        cvData.personalInfo.fechaNacimiento
                      ">
                      <div class="row text-center text-md-start gy-2">
                        <div class="col-md-4" *ngIf="cvData.personalInfo.email">
                          <span class="cv-contact-label">{{ cvData.labels.labelEmail }}</span>
                          <span class="cv-contact-value">{{ cvData.personalInfo.email }}</span>
                        </div>
                        <div class="col-md-4" *ngIf="cvData.personalInfo.celular">
                          <span class="cv-contact-label">{{ cvData.labels.labelPhone }}</span>
                          <span class="cv-contact-value">{{ cvData.personalInfo.celular }}</span>
                        </div>
                        <div class="col-md-4" *ngIf="cvData.personalInfo.ubicacion">
                          <span class="cv-contact-label">{{ cvData.labels.labelAddress }}</span>
                          <span class="cv-contact-value">{{ cvData.personalInfo.ubicacion }}</span>
                        </div>
                        <div class="col-md-4" *ngIf="cvData.personalInfo.nacionalidad">
                          <span class="cv-contact-label">{{ cvData.labels.labelNationality }}</span>
                          <span class="cv-contact-value">{{ cvData.personalInfo.nacionalidad }}</span>
                        </div>
                        <div class="col-md-4" *ngIf="cvData.personalInfo.fechaNacimiento">
                          <span class="cv-contact-label">{{ cvData.labels.labelBirthDate }}</span>
                          <span class="cv-contact-value">{{ cvData.personalInfo.fechaNacimiento }}</span>
                        </div>
                        <div class="col-md-4" *ngIf="getAgeFromBirthDate(cvData.personalInfo.fechaNacimiento) !== null">
                          <span class="cv-contact-label">{{ cvData.labels.labelAge }}</span>
                          <span class="cv-contact-value">
                            {{ getAgeFromBirthDate(cvData.personalInfo.fechaNacimiento) }} años
                          </span>
                        </div>
                      </div>
                    </div>
                  </ng-container>

                  <!-- Fallback: si agregas template-3+ y aún no tiene layout dedicado -->
                  <ng-container *ngSwitchDefault>
                    <!-- Sin fallback visual: si no hay layout para la plantilla, no mostramos nada -->
                  </ng-container>
                </ng-container>
              </div>
            </ng-container>

            <!-- Template 2: Perfil (Resumen profesional) ocupa 100% antes de las columnas -->
            <div class="cv-page-top" *ngIf="selectedTemplateId === 'template-2'" #pageTop></div>

            <div class="cv-columns">
              <div class="row mt-4">
                <div class="col-lg-8 cv-page-left" #pageLeft></div>
                <div class="col-lg-4 cv-page-right" #pageRight></div>
              </div>
            </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Flujo oculto (fuente) para paginar: se reubican bloques, no se hacen scrolls internos. -->
      <div class="cv-flow" aria-hidden="true">
      <div class="a4-page cv-flow-page">
        <div class="a4-inner">
          <div class="cv-layout cv-layout-flow" [ngClass]="'cv-layout-' + selectedTemplateId">
            <!-- Template 2: Perfil (Resumen profesional) en bloque 100% antes de las columnas -->
            <div class="cv-flow-top" *ngIf="selectedTemplateId === 'template-2'" #flowTop>
              <div class="cv-section" *ngIf="cvData.personalInfo.resumenProfesional" data-key="100">
                <h3 class="cv-section-title">{{ cvData.labels.sectionProfile }}</h3>
                <p>{{ cvData.personalInfo.resumenProfesional }}</p>
              </div>
            </div>

            <div class="cv-columns">
              <div class="row mt-4">
                <div class="col-lg-8 cv-flow-left" #flowLeft>
                  <!-- Resumen Profesional -->
                  <ng-container *ngIf="selectedTemplateId !== 'template-2'">
                    <div class="cv-section" *ngIf="cvData.personalInfo.resumenProfesional" data-key="100">
                      <h3 class="cv-section-title">{{ cvData.labels.sectionProfile }}</h3>
                      <p>{{ cvData.personalInfo.resumenProfesional }}</p>
                    </div>
                  </ng-container>

              <!-- Experiencia profesional (paginable por trabajo) -->
              <ng-container *ngIf="getVisibleWorkExperience().length > 0">
                <h3
                  class="cv-section-title"
                  data-key="200"
                  data-section="workExperience"
                  data-role="title">
                  {{ cvData.labels.sectionWorkExperience }}
                </h3>

                <div
                  *ngFor="let exp of getVisibleWorkExperience(); let i = index; trackBy: trackById"
                  class="cv-item"
                  data-section="workExperience"
                  data-role="item"
                  [attr.data-key]="201 + i">
                  <h4>{{ exp.empresa }}</h4>
                  <p class="cv-item-meta">
                    <span class="fw-semibold">{{ exp.puesto }}</span>
                    <span *ngIf="exp.fechaInicio"> · {{ exp.fechaInicio }}</span>
                    <span *ngIf="exp.fechaFin && !exp.actualmenteTrabajando"> - {{ exp.fechaFin }}</span>
                    <span *ngIf="exp.actualmenteTrabajando"> - Actual</span>
                  </p>
                  <ng-container *ngIf="exp.descripcion">
                    <ul class="cv-bullet-list" *ngIf="formatBulletLines(exp.descripcion).length; else expPlainDesc">
                      <li *ngFor="let line of formatBulletLines(exp.descripcion)">
                        {{ line }}
                      </li>
                    </ul>
                    <ng-template #expPlainDesc>
                      <p>{{ exp.descripcion }}</p>
                    </ng-template>
                  </ng-container>
                </div>

                <div class="cv-section-spacer" data-key="299"></div>
              </ng-container>

              <!-- Educación (paginable por item) -->
              <ng-container *ngIf="getVisibleEducation().length > 0">
                <h3
                  class="cv-section-title"
                  data-key="300"
                  data-section="education"
                  data-role="title">
                  {{ cvData.labels.sectionEducation }}
                </h3>

                <div
                  *ngFor="let edu of getVisibleEducation(); let i = index; trackBy: trackById"
                  class="cv-item"
                  data-section="education"
                  data-role="item"
                  [attr.data-key]="301 + i">
                  <h4>{{ edu.institucion }}</h4>
                  <p class="cv-item-meta">
                    <span class="fw-semibold">{{ edu.titulo }}</span>
                    <span *ngIf="edu.ubicacion"> · {{ edu.ubicacion }}</span>
                  </p>
                  <p class="cv-item-meta">
                    <span *ngIf="edu.fechaInicio"> {{ edu.fechaInicio }}</span>
                    <span *ngIf="edu.fechaFin && !edu.enCurso"> - {{ edu.fechaFin }}</span>
                    <span *ngIf="edu.enCurso"> · Actualmente estudiando</span>
                  </p>
                  <p class="cv-item-meta" *ngIf="edu.promedio">
                    Promedio (GPA): {{ edu.promedio }}
                  </p>
                  <ng-container *ngIf="edu.descripcion">
                    <ul class="cv-bullet-list" *ngIf="formatBulletLines(edu.descripcion).length; else eduPlainDesc">
                      <li *ngFor="let line of formatBulletLines(edu.descripcion)">
                        {{ line }}
                      </li>
                    </ul>
                    <ng-template #eduPlainDesc>
                      <p>{{ edu.descripcion }}</p>
                    </ng-template>
                  </ng-container>
                </div>

                <div class="cv-section-spacer" data-key="359"></div>
              </ng-container>

              <!-- Referencias (paginable por item) -->
              <ng-container *ngIf="getVisibleReferences().length > 0">
                <h3
                  class="cv-section-title"
                  data-key="360"
                  data-section="references"
                  data-role="title">
                  {{ cvData.labels.sectionReferences }}
                </h3>

                <div
                  *ngFor="let r of getVisibleReferences(); let i = index; trackBy: trackById"
                  class="cv-item"
                  data-section="references"
                  data-role="item"
                  [attr.data-key]="361 + i">
                  <h4>{{ r.nombre }}</h4>
                  <p class="cv-item-meta" *ngIf="r.cargo || r.empresa || r.relacion">
                    <span *ngIf="r.cargo">{{ r.cargo }}</span>
                    <span *ngIf="r.empresa"> · {{ r.empresa }}</span>
                    <span *ngIf="r.relacion"> · {{ r.relacion }}</span>
                  </p>
                  <p class="cv-item-meta" *ngIf="r.telefono || r.email">
                    <span *ngIf="r.telefono">{{ r.telefono }}</span>
                    <span *ngIf="r.email"> · {{ r.email }}</span>
                  </p>
                </div>

                <div class="cv-section-spacer" data-key="399"></div>
              </ng-container>

                </div>

                <div class="col-lg-4 cv-flow-right" #flowRight>
              <ng-container [ngSwitch]="selectedTemplateId">
                <!-- ========================= -->
                <!-- PLANTILLA 2 (template-2)  -->
                <!-- ========================= -->
                <ng-container *ngSwitchCase="'template-2'">
                  <!-- Proyectos -->
                  <div class="cv-sidebar-section" *ngIf="getVisibleProjects().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionProjects }}</h3>
                    <div *ngFor="let project of getVisibleProjects(); trackBy: trackById" class="cv-sidebar-item">
                      <h4 class="cv-sidebar-item-title d-flex justify-content-between gap-2">
                        <span>{{ project.nombre }}</span>
                        <span class="text-muted" *ngIf="project.fecha">{{ project.fecha }}</span>
                      </h4>
                      <div class="cv-item-meta" *ngIf="project.tecnologias?.length">
                        <span class="d-inline-flex flex-wrap gap-1 align-items-center">
                          <span
                            *ngFor="let tech of project.tecnologias"
                            class="badge bg-secondary">
                            {{ tech }}
                          </span>
                        </span>
                      </div>
                      <p class="mb-1" *ngIf="project.descripcion">{{ project.descripcion }}</p>
                      <a *ngIf="project.url" [href]="project.url" target="_blank" rel="noopener" class="cv-link d-inline-block">
                        {{ project.url }}
                      </a>
                    </div>
                  </div>

                  <!-- Habilidades -->
                  <div class="cv-sidebar-section" *ngIf="getVisibleSkills().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionSkills }}</h3>
                    <div class="cv-t2-skill-tags">
                      <div *ngFor="let skill of getVisibleSkills(); trackBy: trackById" class="cv-t2-skill-pill">
                        <div class="cv-t2-skill-name">{{ skill.nombre }}</div>
                        <div class="cv-t2-skill-meta" *ngIf="skill.categoria || skill.nivel">
                          <span *ngIf="skill.categoria">{{ skill.categoria }}</span>
                          <span class="cv-t2-skill-dot" *ngIf="skill.categoria && skill.nivel">·</span>
                          <span class="cv-t2-skill-level" *ngIf="skill.nivel">{{ skill.nivel }}</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Cursos -->
                  <div class="cv-sidebar-section" *ngIf="getVisibleCourses().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionCourses }}</h3>
                    <div *ngFor="let c of getVisibleCourses(); trackBy: trackById" class="cv-sidebar-item">
                      <div class="d-flex justify-content-between gap-2">
                        <span class="fw-semibold">{{ c.nombre }}</span>
                        <span class="text-muted" *ngIf="c.fecha">{{ c.fecha }}</span>
                      </div>
                      <div class="small text-muted" *ngIf="c.institucion">{{ c.institucion }}</div>
                      <div class="small" *ngIf="c.descripcion">{{ c.descripcion }}</div>
                      <a *ngIf="c.url" [href]="c.url" target="_blank" rel="noopener" class="cv-link d-inline-block">
                        {{ c.url }}
                      </a>
                    </div>
                  </div>

                  <!-- Idiomas -->
                  <div class="cv-sidebar-section" *ngIf="getVisibleLanguages().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionLanguages }}</h3>
                    <div *ngFor="let lang of getVisibleLanguages(); trackBy: trackById" class="cv-sidebar-item d-flex justify-content-between">
                      <span>{{ lang.idioma }}</span>
                      <span class="text-muted text-end text-capitalize">{{ lang.nivel }}</span>
                    </div>
                  </div>
                </ng-container>

                <!-- ========================= -->
                <!-- PLANTILLA 3 (template-3)  -->
                <!-- ========================= -->
                <ng-container *ngSwitchCase="'template-3'">
                  <!-- Idiomas -->
                  <div class="cv-sidebar-section" *ngIf="getVisibleLanguages().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionLanguages }}</h3>
                    <div class="cv-t3-list">
                      <div *ngFor="let lang of getVisibleLanguages(); trackBy: trackById" class="cv-t3-row d-flex justify-content-between">
                        <span>{{ lang.idioma }}</span>
                        <span class="cv-t3-accent text-end text-capitalize">{{ lang.nivel }}</span>
                      </div>
                    </div>
                  </div>

                  <!-- Habilidades -->
                  <div class="cv-sidebar-section" *ngIf="getVisibleSkills().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionSkills }}</h3>
                    <div class="cv-t3-list">
                      <div *ngFor="let skill of getVisibleSkills(); trackBy: trackById" class="cv-t3-skill-row">
                        <div class="cv-t3-skill-main">
                          <div class="cv-t3-skill-name">{{ skill.nombre }}</div>
                          <div class="cv-t3-skill-meta" *ngIf="skill.categoria || skill.nivel">
                            <span class="cv-t3-skill-cat" *ngIf="skill.categoria">{{ skill.categoria }}</span>
                            <span class="cv-t3-skill-dot" *ngIf="skill.categoria && skill.nivel">·</span>
                            <span class="cv-t3-skill-level" *ngIf="skill.nivel">{{ skill.nivel }}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Cursos -->
                  <div class="cv-sidebar-section" *ngIf="getVisibleCourses().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionCourses }}</h3>
                    <div class="cv-t3-list">
                      <div *ngFor="let c of getVisibleCourses(); trackBy: trackById" class="cv-t3-row">
                        <div class="d-flex justify-content-between gap-2">
                          <span class="fw-semibold">{{ c.nombre }}</span>
                          <span class="text-muted" *ngIf="c.fecha">{{ c.fecha }}</span>
                        </div>
                        <div class="small text-muted" *ngIf="c.institucion">{{ c.institucion }}</div>
                        <div class="small" *ngIf="c.descripcion">{{ c.descripcion }}</div>
                        <a *ngIf="c.url" [href]="c.url" target="_blank" rel="noopener" class="cv-link d-inline-block">
                          {{ c.url }}
                        </a>
                      </div>
                    </div>
                  </div>

                  <!-- Proyectos -->
                  <div class="cv-sidebar-section" *ngIf="getVisibleProjects().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionProjects }}</h3>
                    <div class="cv-t3-projects">
                      <div *ngFor="let project of getVisibleProjects(); trackBy: trackById" class="cv-t3-project-card">
                        <div class="cv-t3-project-head">
                          <div class="cv-t3-project-name">{{ project.nombre }}</div>
                          <div class="cv-t3-project-date" *ngIf="project.fecha">{{ project.fecha }}</div>
                        </div>
                        <div class="cv-t3-project-desc" *ngIf="project.descripcion">{{ project.descripcion }}</div>
                        <a *ngIf="project.url" [href]="project.url" target="_blank" rel="noopener" class="cv-link d-inline-block">
                          {{ project.url }}
                        </a>
                        <div class="cv-t3-chips" *ngIf="project.tecnologias?.length">
                          <span *ngFor="let tech of project.tecnologias" class="cv-t3-chip">{{ tech }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </ng-container>

                <!-- ========================= -->
                <!-- PLANTILLA 4 (template-4)  -->
                <!-- ========================= -->
                <ng-container *ngSwitchCase="'template-4'">
                  <!-- Lado izquierdo: sin estilos extra, solo cards como antes -->
                  <!-- Idiomas -->
                  <div class="cv-sidebar-section" *ngIf="getVisibleLanguages().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionLanguages }}</h3>
                    <div *ngFor="let lang of getVisibleLanguages(); trackBy: trackById" class="cv-sidebar-item d-flex justify-content-between">
                      <span>{{ lang.idioma }}</span>
                      <span class="text-muted text-end text-capitalize">{{ lang.nivel }}</span>
                    </div>
                  </div>

                  <!-- Habilidades -->
                  <div class="cv-sidebar-section" *ngIf="getVisibleSkills().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionSkills }}</h3>
                    <div *ngFor="let skill of getVisibleSkills(); trackBy: trackById" class="cv-sidebar-item">
                      <div class="d-flex justify-content-between">
                        <span>{{ skill.nombre }}</span>
                        <span class="text-muted text-capitalize">{{ skill.nivel }}</span>
                      </div>
                      <small class="text-muted text-capitalize" *ngIf="skill.categoria">{{ skill.categoria }}</small>
                    </div>
                  </div>

                  <!-- Cursos -->
                  <div class="cv-sidebar-section" *ngIf="getVisibleCourses().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionCourses }}</h3>
                    <div *ngFor="let c of getVisibleCourses(); trackBy: trackById" class="cv-sidebar-item">
                      <div class="d-flex justify-content-between gap-2">
                        <span class="fw-semibold">{{ c.nombre }}</span>
                        <span class="text-muted" *ngIf="c.fecha">{{ c.fecha }}</span>
                      </div>
                      <div class="small text-muted" *ngIf="c.institucion">{{ c.institucion }}</div>
                      <div class="small" *ngIf="c.descripcion">{{ c.descripcion }}</div>
                      <a *ngIf="c.url" [href]="c.url" target="_blank" rel="noopener" class="cv-link d-inline-block">
                        {{ c.url }}
                      </a>
                    </div>
                  </div>

                  <!-- Proyectos -->
                  <div class="cv-sidebar-section" *ngIf="getVisibleProjects().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionProjects }}</h3>
                    <div *ngFor="let project of getVisibleProjects(); trackBy: trackById" class="cv-sidebar-item">
                      <h4 class="cv-sidebar-item-title d-flex justify-content-between gap-2">
                        <span>{{ project.nombre }}</span>
                        <span class="text-muted" *ngIf="project.fecha">{{ project.fecha }}</span>
                      </h4>
                      <p class="mb-1" *ngIf="project.descripcion">{{ project.descripcion }}</p>
                      <a *ngIf="project.url" [href]="project.url" target="_blank" rel="noopener" class="cv-link d-inline-block">
                        {{ project.url }}
                      </a>
                    </div>
                  </div>
                </ng-container>

                <!-- ========================= -->
                <!-- PLANTILLA 5 (template-5)  -->
                <!-- ========================= -->
                <ng-container *ngSwitchCase="'template-5'">
                  <!-- Idiomas -->
                  <div class="cv-sidebar-section" *ngIf="getVisibleLanguages().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionLanguages }}</h3>
                    <div *ngFor="let lang of getVisibleLanguages(); trackBy: trackById" class="cv-sidebar-item d-flex justify-content-between">
                      <span>{{ lang.idioma }}</span>
                      <span class="text-muted text-end text-capitalize">{{ lang.nivel }}</span>
                    </div>
                  </div>

                  <!-- Habilidades -->
                  <div class="cv-sidebar-section cv-t5-skill-section" *ngIf="getVisibleSkills().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionSkills }}</h3>
                    <div *ngFor="let skill of getVisibleSkills(); trackBy: trackById" class="cv-sidebar-item d-flex justify-content-between">
                      <span>{{ skill.nombre }}</span>
                      <span class="text-muted text-end text-capitalize" *ngIf="skill.nivel">{{ skill.nivel }}</span>
                    </div>
                  </div>

                  <!-- Cursos -->
                  <div class="cv-sidebar-section" *ngIf="getVisibleCourses().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionCourses }}</h3>
                    <div *ngFor="let c of getVisibleCourses(); trackBy: trackById" class="cv-sidebar-item">
                      <div class="d-flex justify-content-between gap-2">
                        <span class="fw-semibold">{{ c.nombre }}</span>
                        <span class="text-muted" *ngIf="c.fecha">{{ c.fecha }}</span>
                      </div>
                      <div class="small text-muted" *ngIf="c.institucion">{{ c.institucion }}</div>
                      <div class="small" *ngIf="c.descripcion">{{ c.descripcion }}</div>
                      <a *ngIf="c.url" [href]="c.url" target="_blank" rel="noopener" class="cv-link d-inline-block">
                        {{ c.url }}
                      </a>
                    </div>
                  </div>

                  <!-- Proyectos -->
                  <div class="cv-sidebar-section" *ngIf="getVisibleProjects().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionProjects }}</h3>
                    <div *ngFor="let project of getVisibleProjects(); trackBy: trackById" class="cv-sidebar-item">
                      <div class="d-flex justify-content-between gap-2">
                        <span class="fw-semibold">{{ project.nombre }}</span>
                        <span class="text-muted" *ngIf="project.fecha">{{ project.fecha }}</span>
                      </div>
                      <div class="small text-muted" *ngIf="project.url">{{ project.url }}</div>
                    </div>
                  </div>
                </ng-container>

                <!-- ========================= -->
                <!-- PLANTILLA 6 (template-6)  -->
                <!-- ========================= -->
                <ng-container *ngSwitchCase="'template-6'">
                  <!-- Sidebar (izquierda): Foto + Nombre + Puesto -->
                  <div class="cv-t6-sidebar-identity">
                    <div class="cv-photo-circle cv-photo-circle--t6" *ngIf="cvData.personalInfo.foto">
                      <img [src]="cvData.personalInfo.foto" alt="Foto de perfil" class="cv-photo-img">
                    </div>
                    <div class="cv-t6-sidebar-name">
                      <div class="cv-t6-name">
                        {{ cvData.personalInfo.nombres }} {{ cvData.personalInfo.apellidos }}
                      </div>
                      <div class="cv-t6-position" *ngIf="cvData.personalInfo.puesto">
                        {{ cvData.personalInfo.puesto }}
                      </div>
                    </div>
                  </div>

                  <!-- Contacto (sidebar) -->
                  <div class="cv-t6-sidebar-contact">
                    <div class="cv-t6-kv" *ngIf="cvData.personalInfo.email">
                      <div class="k">{{ cvData.labels.labelEmail }}</div>
                      <div class="v">{{ cvData.personalInfo.email }}</div>
                    </div>
                    <div class="cv-t6-kv" *ngIf="cvData.personalInfo.celular">
                      <div class="k">{{ cvData.labels.labelPhone }}</div>
                      <div class="v">{{ cvData.personalInfo.celular }}</div>
                    </div>
                    <div class="cv-t6-kv" *ngIf="cvData.personalInfo.ubicacion">
                      <div class="k">{{ cvData.labels.labelAddress }}</div>
                      <div class="v">{{ cvData.personalInfo.ubicacion }}</div>
                    </div>
                    <div class="cv-t6-kv" *ngIf="cvData.personalInfo.nacionalidad">
                      <div class="k">{{ cvData.labels.labelNationality }}</div>
                      <div class="v">{{ cvData.personalInfo.nacionalidad }}</div>
                    </div>
                    <div class="cv-t6-kv" *ngIf="cvData.personalInfo.fechaNacimiento">
                      <div class="k">{{ cvData.labels.labelBirthDate }}</div>
                      <div class="v">{{ cvData.personalInfo.fechaNacimiento }}</div>
                    </div>
                    <div class="cv-t6-kv" *ngIf="getAgeFromBirthDate(cvData.personalInfo.fechaNacimiento) !== null">
                      <div class="k">{{ cvData.labels.labelAge }}</div>
                      <div class="v">{{ getAgeFromBirthDate(cvData.personalInfo.fechaNacimiento) }} años</div>
                    </div>
                  </div>

                  <!-- Idiomas -->
                  <div class="cv-sidebar-section" *ngIf="getVisibleLanguages().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionLanguages }}</h3>
                    <div *ngFor="let lang of getVisibleLanguages(); trackBy: trackById" class="cv-sidebar-item d-flex justify-content-between">
                      <span>{{ lang.idioma }}</span>
                      <span class="text-muted text-end text-capitalize">{{ lang.nivel }}</span>
                    </div>
                  </div>

                  <!-- Habilidades -->
                  <div class="cv-sidebar-section" *ngIf="getVisibleSkills().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionSkills }}</h3>
                    <div *ngFor="let skill of getVisibleSkills(); trackBy: trackById" class="cv-sidebar-item">
                      <div class="d-flex justify-content-between">
                        <span>{{ skill.nombre }}</span>
                        <span class="text-muted text-capitalize" *ngIf="skill.nivel">{{ skill.nivel }}</span>
                      </div>
                      <small class="text-muted text-capitalize" *ngIf="skill.categoria">{{ skill.categoria }}</small>
                    </div>
                  </div>

                  <!-- Cursos -->
                  <div class="cv-sidebar-section" *ngIf="getVisibleCourses().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionCourses }}</h3>
                    <div *ngFor="let c of getVisibleCourses(); trackBy: trackById" class="cv-sidebar-item">
                      <div class="d-flex justify-content-between gap-2">
                        <span class="fw-semibold">{{ c.nombre }}</span>
                        <span class="text-muted" *ngIf="c.fecha">{{ c.fecha }}</span>
                      </div>
                      <div class="small text-muted" *ngIf="c.institucion">{{ c.institucion }}</div>
                      <div class="small" *ngIf="c.descripcion">{{ c.descripcion }}</div>
                      <a *ngIf="c.url" [href]="c.url" target="_blank" rel="noopener" class="cv-link d-inline-block">
                        {{ c.url }}
                      </a>
                    </div>
                  </div>

                  <!-- Proyectos -->
                  <div class="cv-sidebar-section" *ngIf="getVisibleProjects().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionProjects }}</h3>
                    <div *ngFor="let project of getVisibleProjects(); trackBy: trackById" class="cv-sidebar-item">
                      <div class="d-flex justify-content-between gap-2">
                        <span class="fw-semibold">{{ project.nombre }}</span>
                        <span class="text-muted" *ngIf="project.fecha">{{ project.fecha }}</span>
                      </div>
                      <div class="small text-muted" *ngIf="project.url">{{ project.url }}</div>
                    </div>
                  </div>
                </ng-container>

                <!-- ========================= -->
                <!-- PLANTILLA 1 (template-1)  -->
                <!-- ========================= -->
                <ng-container *ngSwitchCase="'template-1'">
                  <!-- Idiomas -->
                  <div class="cv-sidebar-section" *ngIf="getVisibleLanguages().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionLanguages }}</h3>
                    <div *ngFor="let lang of getVisibleLanguages(); trackBy: trackById" class="cv-sidebar-item d-flex justify-content-between">
                      <span>{{ lang.idioma }}</span>
                      <span class="text-muted text-end text-capitalize">{{ lang.nivel }}</span>
                    </div>
                  </div>

                  <!-- Habilidades -->
                  <div class="cv-sidebar-section" *ngIf="getVisibleSkills().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionSkills }}</h3>
                    <div *ngFor="let skill of getVisibleSkills(); trackBy: trackById" class="cv-sidebar-item">
                      <div class="d-flex justify-content-between">
                        <span>{{ skill.nombre }}</span>
                        <span class="text-muted text-capitalize">{{ skill.nivel }}</span>
                      </div>
                      <small class="text-muted text-capitalize">{{ skill.categoria }}</small>
                    </div>
                  </div>

                  <!-- Cursos -->
                  <div class="cv-sidebar-section" *ngIf="getVisibleCourses().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionCourses }}</h3>
                    <div *ngFor="let c of getVisibleCourses(); trackBy: trackById" class="cv-sidebar-item">
                      <h4 class="cv-sidebar-item-title d-flex justify-content-between gap-2">
                        <span>{{ c.nombre }}</span>
                        <span class="text-muted" *ngIf="c.fecha">{{ c.fecha }}</span>
                      </h4>
                      <p class="cv-item-meta mb-1" *ngIf="c.institucion">{{ c.institucion }}</p>
                      <p class="mb-1" *ngIf="c.descripcion">{{ c.descripcion }}</p>
                      <a *ngIf="c.url" [href]="c.url" target="_blank" rel="noopener" class="cv-link d-inline-block">
                        {{ c.url }}
                      </a>
                    </div>
                  </div>

                  <!-- Proyectos -->
                  <div class="cv-sidebar-section" *ngIf="getVisibleProjects().length > 0">
                    <h3 class="cv-sidebar-title">{{ cvData.labels.sectionProjects }}</h3>
                    <div *ngFor="let project of getVisibleProjects(); trackBy: trackById" class="cv-sidebar-item">
                      <h4 class="cv-sidebar-item-title d-flex justify-content-between gap-2">
                        <span>{{ project.nombre }}</span>
                        <span class="text-muted" *ngIf="project.fecha">{{ project.fecha }}</span>
                      </h4>
                      <div class="cv-item-meta" *ngIf="project.tecnologias?.length">
                        <span class="d-inline-flex flex-wrap gap-1 align-items-center">
                          <span
                            *ngFor="let tech of project.tecnologias"
                            class="badge bg-secondary">
                            {{ tech }}
                          </span>
                        </span>
                      </div>
                      <p class="mb-1" *ngIf="project.descripcion">{{ project.descripcion }}</p>
                      <a *ngIf="project.url" [href]="project.url" target="_blank" rel="noopener" class="cv-link d-inline-block">
                        {{ project.url }}
                      </a>
                    </div>
                  </div>
                </ng-container>

                <!-- Fallback: templates nuevos aún sin sidebar dedicado -->
                <ng-container *ngSwitchDefault>
                  <!-- Sin fallback visual -->
                </ng-container>
              </ng-container>

                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      </div>
    </ng-container>
  </div>

  <ng-template #emptyState>
    <div class="empty-preview">
      <div class="empty-preview-content">
        <i class="material-icons empty-icon">description</i>
        <p class="empty-text">Completa el formulario para ver la vista previa de tu CV</p>
      </div>
    </div>
  </ng-template>

  <!-- Botón de descarga -->
  <div class="preview-actions mt-4" *ngIf="hasData()">
    <button
      class="btn btn-primary btn-download"
      type="button"
      (click)="downloadCV()"
      [disabled]="isDownloading"
      [attr.aria-busy]="isDownloading">
      <ng-container *ngIf="!isDownloading; else downloadingTpl">
        <i class="material-icons">download</i>
        Descargar PDF
      </ng-container>
      <ng-template #downloadingTpl>
        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
        Generando PDF...
      </ng-template>
    </button>
  </div>
</div>
