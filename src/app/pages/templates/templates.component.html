<div class="form-section">
  <div class="d-flex justify-content-between align-items-start flex-wrap gap-2 mb-3">
    <div>
      <h3 class="form-section-title d-flex align-items-center gap-2 mb-1">
        <i class="material-icons">palette</i>
        {{ 'design.title' | translate }}
      </h3>
      <p class="text-muted mb-0">
        {{ 'design.subtitle' | translate }}
      </p>
    </div>
  </div>

  <div class="template-card">
    <div class="template-card-header">
      <div class="d-flex align-items-center gap-2">
        <i class="material-icons">view_quilt</i>
        <h4 class="group-title mb-0">{{ 'design.templates.title' | translate }}</h4>
      </div>
      <!-- <span class="badge text-bg-light">Actual: {{ selectedTemplateId }}</span> -->
    </div>

    <div class="template-card-body">
      <div class="templates-strip" [attr.aria-label]="'design.templates.galleryAria' | translate">
        <button
          *ngFor="let t of templateGallery; trackBy: trackByTemplateId"
          type="button"
          class="template-mini"
          (click)="selectTemplate(t.id)"
          [class.selected]="selectedTemplateId === t.id">
          <div class="template-mini-preview" aria-hidden="true">
            <img
              class="preview-img preview-img-base"
              [src]="t.previewBase"
              alt=""
              loading="lazy">
            <img
              class="preview-img preview-img-hover"
              [src]="t.previewHover"
              alt=""
              loading="lazy">
          </div>

          <div class="template-mini-meta">
            <div class="template-mini-name-row">
              <div class="template-mini-name">{{ t.nombre }}</div>
              <span class="template-badge-selected" *ngIf="selectedTemplateId === t.id">
                <i class="material-icons">check_circle</i>
                {{ 'design.templates.selected' | translate }}
              </span>
            </div>
            <div class="template-mini-sub text-muted">
              <ng-container *ngFor="let tag of t.tags; let last = last">
                <span class="tag">{{ tag }}</span>
                <span class="dot" *ngIf="!last">·</span>
              </ng-container>
            </div>
          </div>
        </button>
      </div>
    </div>
  </div>

  <div class="template-card mt-3">
    <div class="template-card-header">
      <div class="d-flex align-items-center gap-2">
        <i class="material-icons">format_paint</i>
        <h4 class="group-title mb-0">{{ 'design.primaryColor.title' | translate }}</h4>
      </div>
      <span class="badge text-bg-light">{{ 'design.primaryColor.badge' | translate }}</span>
    </div>

    <div class="template-card-body">
      <div class="color-grid">
        <button
          type="button"
          class="color-option"
          *ngFor="let c of colors"
          (click)="selectColor(c.value)"
          [class.selected]="selectedColor === c.value"
          [attr.aria-pressed]="selectedColor === c.value"
          [attr.aria-label]="c.name + ' (' + c.value + ')'"
          [attr.title]="c.name + (c.hint ? ' · ' + c.hint : '')">
          <span class="swatch" [style.background]="c.value"></span>
          <i class="material-icons check" *ngIf="selectedColor === c.value">check_circle</i>
        </button>
      </div>

      <!-- <div class="selected-row mt-3">
        <span class="text-muted">Seleccionado:</span>
        <span class="selected-chip">
          <span class="chip-swatch" [style.background]="selectedColor"></span>
          <span class="chip-text">{{ selectedColor }}</span>
        </span>
      </div> -->

      <div class="custom-color-row mt-3">
        <div class="text-muted mb-2">{{ 'design.primaryColor.customHint' | translate }}</div>
        <div class="custom-color-controls">
          <input
            class="color-picker"
            type="color"
            [value]="selectedColor"
            (input)="selectColor($any($event.target).value)"
            [attr.aria-label]="'design.primaryColor.colorPickerAria' | translate">

          <input
            class="form-control hex-input"
            type="text"
            [value]="selectedColor"
            (change)="onHexChange($any($event.target).value)"
            [placeholder]="'design.primaryColor.hexPlaceholder' | translate"
            [attr.aria-label]="'design.primaryColor.hexAria' | translate">
        </div>
      </div>
    </div>
  </div>

  <div class="template-card mt-3">
    <div class="template-card-header">
      <div class="d-flex align-items-center gap-2">
        <i class="material-icons">layers</i>
        <h4 class="group-title mb-0">Color secundario</h4>
      </div>
      <span class="badge text-bg-light">Hoja</span>
    </div>

    <div class="template-card-body">
      <p class="text-muted mb-3">
        Cambia el <strong>fondo de la hoja</strong> del CV (la página A4).
      </p>

      <div class="color-grid">
        <button
          type="button"
          class="color-option"
          *ngFor="let c of paperColors"
          (click)="selectPaperColor(c.value)"
          [class.selected]="selectedPaperColor === c.value"
          [attr.aria-pressed]="selectedPaperColor === c.value"
          [attr.aria-label]="c.name + ' (' + c.value + ')'">
          <span class="swatch" [style.background]="c.value"></span>
          <i class="material-icons check" *ngIf="selectedPaperColor === c.value">check_circle</i>
        </button>
      </div>

      <div class="custom-color-row mt-3">
        <div class="text-muted mb-2">Personaliza el fondo si quieres</div>
        <div class="custom-color-controls">
          <input
            class="color-picker"
            type="color"
            [value]="selectedPaperColor"
            (input)="selectPaperColor($any($event.target).value)"
            aria-label="Selector de color de fondo">

          <input
            class="form-control hex-input"
            type="text"
            [value]="selectedPaperColor"
            (change)="onPaperHexChange($any($event.target).value)"
            placeholder="#RRGGBB"
            aria-label="Color de fondo en HEX">
        </div>
      </div>
    </div>
  </div>

  <div class="template-card mt-3">
    <div class="template-card-header">
      <div class="d-flex align-items-center gap-2">
        <i class="material-icons">text_fields</i>
        <h4 class="group-title mb-0">Tipografía</h4>
      </div>
      <span class="badge text-bg-light">Texto</span>
    </div>

    <div class="template-card-body">
      <div class="typography-controls">
        <div class="typography-field">
          <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-2">
            <label class="form-label mb-0">Fuente</label>
            <input
              class="form-control form-control-sm font-search"
              type="search"
              [value]="fontQuery"
              (input)="fontQuery = $any($event.target).value"
              placeholder="Buscar fuente…"
              aria-label="Buscar fuente">
          </div>

          <div class="font-grid" role="list" aria-label="Lista de fuentes">
            <button
              type="button"
              class="font-option"
              *ngFor="let f of filteredFontFamilies"
              (click)="selectFontFamily(f.value)"
              [class.selected]="selectedFontFamily === f.value"
              [style.font-family]="f.value"
              [attr.aria-pressed]="selectedFontFamily === f.value">
              <div class="font-option-name">{{ f.name }}</div>
              <div class="font-option-sample text-muted">Aa Bb Cc · 012345</div>
              <i class="material-icons font-option-check" *ngIf="selectedFontFamily === f.value">check_circle</i>
            </button>
          </div>
        </div>

        <div class="typography-field">
          <label class="form-label mb-2">Tamaño</label>

          <div class="size-row" role="group" aria-label="Tamaño de fuente">
            <button
              type="button"
              class="size-pill"
              *ngFor="let s of fontSizes"
              (click)="selectFontSize(s.value)"
              [class.selected]="selectedFontSize === s.value"
              [attr.aria-pressed]="selectedFontSize === s.value">
              {{ s.label }}
            </button>
          </div>

          <div class="text-muted small mt-2" *ngIf="selectedFontSizeMeta">
            {{ selectedFontSizeMeta.label }} — {{ selectedFontSizeMeta.hint }}
          </div>

          <div class="size-preview mt-2" [style.font-family]="selectedFontFamily">
            <div class="size-preview-title">Ejemplo de título</div>
            <div class="size-preview-body">Texto de ejemplo para ver legibilidad y densidad.</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


